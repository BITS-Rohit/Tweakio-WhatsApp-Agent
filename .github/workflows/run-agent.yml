name: Run Tweakio Agent

on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 */5 * * *'

jobs:
  run-tweakio-agent:
    runs-on: ubuntu-latest

    env:
      PROFILE: ${{ secrets.PROFILE }}
      BOT_NAME: ${{ secrets.BOT_NAME }}
      BOT_NUMBER: ${{ secrets.BOT_NUMBER }}
      ADMIN_NUMBER: ${{ secrets.ADMIN_NUMBER }}
      ADMIN_NAME: ${{ secrets.ADMIN_NAME }}

      # GitHub
      GH_TOKEN: ${{ secrets.GH_TOKEN }}
      REPO_NAME: ${{ secrets.REPO_NAME }}
      BRANCH_NAME: ${{ secrets.BRANCH_NAME }}

      # API Keys
      YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
      GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
      GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

      # Custom Search
      CSE_ID: ${{ secrets.CSE_ID }}

      # Agent.ai Integration
      AGENT_AI_KEY: ${{ secrets.AGENT_AI_KEY }}
      QUANTIFIER: ${{ secrets.QUANTIFIER }}
      AGENT_ID: ${{ secrets.AGENT_ID }}
      WEBHOOK_ID: ${{ secrets.WEBHOOK_ID }}
      BASE_URL: ${{ secrets.BASE_URL }}
      INTRO_IMG_URL: ${{ secrets.INTRO_IMG_URL }}

    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v3

      - name: â˜• Set up Java 17
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: ðŸ§± Build and copy dependencies
        run: |
          mvn clean compile
          mkdir -p target/dependency
          mvn dependency:copy-dependencies -DoutputDirectory=target/dependency -DincludeScope=runtime

      - name: ðŸš€ Run the Tweakio Agent
        run: java -cp "target/classes:target/dependency/*" org.Tweakio.WhatsappWeb.WebMain
